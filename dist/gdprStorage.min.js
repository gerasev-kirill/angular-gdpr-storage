/*! angular-gdpr-storage 0.9.7 | Copyright (c) 2018 Gerasev Kirill | MIT License | Copyright (c) 2015 Gias Kay Lee | MIT License */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["angular"],b):"object"==typeof exports?module.exports=b(require("angular")):b(a.angular)}(this,function(a){"use strict";var b,c,d,e,f,g,h,i,j,k;c="ngStorage-",b=function(a){return this.name="GdprException",this.message=a||"",this},b.prototype=new Error,b.prototype.constructor=b,e=function(a){return a.slice(c.length)},d=function(d,f,g,h,i,j,k){var l,m,n,o,p,q,r;return m=null,n=null,k=k||{},r=a.toJson,o=function(b){var c,d;try{return a.fromJson(b)}catch(d){return void(c=d)}},p=function(){var b,c,d,e,h,i,k;try{k=f.sessionStorage}catch(c){b=c,k=!1}try{i=f.localStorage}catch(d){b=d,i=!1}if(i){h="__"+Math.round(1e7*Math.random());try{i.setItem(h,h),i.removeItem(h)}catch(e){b=e,i=!1}}return function(b){var c;return"gdprStorage"===b&&(b=j),c=null,"localStorage"===b&&i?c=i:"sessionStorage"===b&&k&&(c=k),c?c:(g.warn("This browser does not support Web Storage!"),{setItem:a.noop,getItem:a.noop,removeItem:a.noop,key:a.noop})}}(),l={$default:function(b){var c,d;for(c in b)d=b[c],a.isDefined(l[c])||(l[c]=d);return l.$sync(),l},$reset:function(a){var b,d;d=p(i);for(b in l)"$"!==b[0]&&(delete l[b],d.removeItem(c+b));return l.$default(a)},$sync:function(){var b,d,f,g;g=p(i);for(d in g)d&&0===d.indexOf(c)&&(b=e(d),("gdprStorage"!==i||k[b])&&(f=o(g.getItem(d)),"gdprStorage"===i&&"gdprPermission"===b?l.$setPermission(f):a.isDefined(f)?l[b]=f:delete l[b]))},$apply:function(){var d,e,f,g;if(m=null,e=void 0,g=p(i),!a.equals(l,n)){e=a.copy(n);for(d in l)if(f=l[d],a.isDefined(f)&&"$"!==d[0]){if("gdprStorage"===i&&!k[d])throw new b("You can't assign key '"+d+"' for $gdprStorage! Please register key '"+d+"' inside config block with this: $gdprStorageProvider.registerKey('"+d+"')");g.setItem(c+d,r(f)),delete e[d]}for(d in e)g.removeItem(c+d);n=a.copy(l)}}},"gdprStorage"===i&&(l.gdprPermission={app:!1},l.$getAllowedKeys=function(){return a.copy(k)},q="none",l.$setPermission=function(b){var f,g,h,i,k,m,n;if(b=b||{},b.app=!!b.app,k=b.app?"localStorage":"sessionStorage",l.gdprPermission=b,"none"===q?(d.$emit("storage.gdpr.init"),q="init"):(q="update",d.$emit("storage.gdpr.permissionUpdate")),i=p(j),h=p(k),h.setItem(c+"gdprPermission",r(b)),k!==j){if(i)for(g in i)m=i[g],g&&0===g.indexOf(c)&&(g!==c+"gdprPermission"&&h.setItem(g,m),i.removeItem(g));for(g in h)g&&0===g.indexOf(c)&&(f=e(g),n=o(h.getItem(g)),a.isDefined(n)&&(l[f]=n));j=k}}),l.$sync(),n=a.copy(l),f.addEventListener("storage",function(b){var f,g;b&&b.key&&(f=e(b.key),b.key===c+f&&b.storageArea===p(i)&&(g=o(b.newValue),a.isDefined(g)?l[f]=g:delete l[f],n=a.copy(l),d.$$phase||d.$apply()))}),f.addEventListener("beforeunload",function(a){l.$apply()},!1),l},g=null,h=null,f=null,j=null,k=null,i=null,a.module("storage.gdpr",[]).provider("storageSettings",function(){var b,d;return b=null,d={},this.setPrefix=function(a){c=a||""},this.registerThirdPartyServiceLiteral=function(a,b){d[a]=b||[]},this.$get=function(){return b||(b={defaultAllowAll:!1,isBannerVisible:!1,thirdPartyServices:[],getPrefix:function(){return c},setBannerVisibility:function(a){b.isBannerVisible=a===!0||"visible"===a},getThirdPartyLiterals:function(){return a.copy(d)}}),b},this}).service("$localStorage",["$rootScope","$window","$log","$timeout",function(a,b,c,e){var f;return f=null,g?g.$sync():g=d(a,b,c,e,"localStorage"),j&&j(),j=a.$watch(function(){return f||(f=e(function(){return g.$apply()},100,!1)),f}),g}]).service("$sessionStorage",["$rootScope","$window","$log","$timeout",function(a,b,c,e){var f;return f=null,h?h.$sync():h=d(a,b,c,e,"sessionStorage"),k&&k(),k=a.$watch(function(){return f||(f=e(function(){return h.$apply()},100,!1)),f}),h}]).provider("$gdprStorage",function(){var b;return b={},this.registerKey=function(a,c){c=c||{},b[a]=c},this.$get=["$rootScope","$window","$log","$timeout",function(c,e,j,k){var l,m,n,o,p;if(l=null,f)f.$sync();else{h?h.$sync():h=d(c,e,j,k,"sessionStorage"),g?g.$sync():g=d(c,e,j,k,"localStorage"),n={app:!1},a.isObject(g.gdprPermission)?n=g.gdprPermission:a.isObject(h.gdprPermission)&&(n=h.gdprPermission);for(m in b)p="",h[m]&&(p=h[m]),g&&g[m]&&(p=g[m]),""!==p&&(n.app?g[m]=p:h[m]=p);n.app?(g.$apply(),o="localStorage"):(h.$apply(),o="sessionStorage"),f=d(c,e,j,k,"gdprStorage",o,b),f.$setPermission(n)}return i&&i(),i=c.$watch(function(){return l||(l=k(function(){return f.$apply()},100,!1)),l}),f}],this}).config(["$gdprStorageProvider",function(a){return a.registerKey("gdprPermission",{description:"GDPR permission data for site"})}]),a.module("storage.gdpr").directive("gdprRequestPermissionBanner",function(){return{restrict:"E",scope:{defaultAllowAll:"@?"},controller:["$scope","$element","$gdprStorage","storageSettings",function(a,b,c,d){return a.storageSettings=d,c.gdprPermission.app||d.setBannerVisibility(!0),d.defaultAllowAll="true"===a.defaultAllowAll,a.$watch("storageSettings.isBannerVisible",function(a){a?b.addClass("visible"):b.removeClass("visible")})}],template:'\n<div class="container" ng-if="storageSettings.isBannerVisible">\n  <gdpr-request-permission-area></gdpr-request-permission-area>\n</div>'}}).directive("gdprRequestPermissionArea",function(){return{restrict:"E",scope:{},controller:["$scope","$rootScope","$timeout","$gdprStorage","storageSettings",function(b,c,d,e,f){var g,h,i,j;b.storageSettings=f,b.options={permission:a.copy(e.gdprPermission),isDetailsVisible:!1,activeTab:0},g=[],j=e.$getAllowedKeys();for(h in j)i=j[h],g.push({key:h,provider:i.provider||"This site",purpose:i.purpose||"Settings",expiry:i.expiry||"Never",type:i.type||"Value in localStorage"});b.$watchCollection("storageSettings.thirdPartyServices",function(c,d){var e,h,i,j,k,l,m,n;for(b.SERVICES=[{type:"app",name:"Site settings",cookies:g}],k=f.getThirdPartyLiterals(),l=c||[],e=0,i=l.length;e<i;e++)n=l[e],a.isString(n)&&k[n]?b.SERVICES.push(k[n]):a.isObject(n)&&b.SERVICES.push(n);if(f.defaultAllowAll)for(m=b.SERVICES,h=0,j=m.length;h<j;h++)n=m[h],b.options.permission[n.type]=!0}),c.$on("storage.gdpr.update",function(){b.options.permission=a.copy(e.gdprPermission)}),b.onCancel=function(){var a;for(a in b.options.permission)b.options.permission[a]=!1;e.$setPermission(b.options.permission),f.setBannerVisibility(!1)},b.onAccept=function(){e.$setPermission(b.options.permission),f.setBannerVisibility(!1),c.$emit("storage.gdpr.userPermissionAccept")},b.onAcceptAll=function(){var a,c,e,f;for(e=b.SERVICES||[],a=0,c=e.length;a<c;a++)f=e[a],b.options.permission[f.type]=!0;d(b.onAccept,900)},b.toggleDetails=function(){return b.options.isDetailsVisible=!b.options.isDetailsVisible}}],template:'\n<table class="gdpr-request-permission-area-content">\n  <tbody>\n    <tr>\n      <td>\n        <h5><b translate="">This website uses cookies and local storage</b></h5>\n        <p class="gdpr-text"><span translate="">We use cookies to personalise content and ads, to provide social media features and to analyse our traffic. You should consent to our cookies if you continue to use our website.</span><span> </span><a ng-click="toggleDetails()" ng-switch="options.isDetailsVisible"><span translate="" ng-switch-when="true">Hide details</span><span translate="" ng-switch-when="false">Show details about cookies and local storage</span></a></p>\n        <div class="gdpr-request-permission-area-content-checkboxes">\n          <div class="checkbox-inline" ng-repeat="service in SERVICES">\n            <label>\n              <input type="checkbox" ng-model="options.permission[service.type]"/><span> </span><span>{{service.name | translate}}</span>\n            </label>\n          </div>\n        </div>\n        <div class="gdpr-request-permission-area-content-details" ng-if="options.isDetailsVisible">\n          <uib-tabset class="uib-tabset-sm" active="options.activeTab">\n            <uib-tab ng-repeat="service in SERVICES" index="$index" heading="{{service.name | translate}}">\n              <p class="gdpr-text" ng-if="service.description">{{service.description | translate}}</p>\n              <table class="table table-striped table-bordered table-condensed">\n                <thead>\n                  <tr>\n                    <th class="gdpr-text" translate="">Name</th>\n                    <th class="gdpr-text" translate="">Provider</th>\n                    <th class="gdpr-text" translate="">Purpose</th>\n                    <th class="gdpr-text" translate="">Expiry</th>\n                    <th class="gdpr-text" translate="">Type</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr ng-repeat="cookie in service.cookies">\n                    <td class="gdpr-text">{{cookie.key}}</td>\n                    <td class="gdpr-text">{{cookie.provider | translate}}</td>\n                    <td class="gdpr-text">{{cookie.purpose | translate}}</td>\n                    <td class="gdpr-text">{{cookie.expiry | translate}}</td>\n                    <td class="gdpr-text">{{cookie.type | translate}}</td>\n                  </tr>\n                </tbody>\n              </table>\n            </uib-tab>\n          </uib-tabset>\n        </div>\n      </td>\n      <td class="gdpr-request-permission-area-content-btns hidden-xs hidden-sm" ng-switch="!!storageSettings.defaultAllowAll">\n        <table ng-switch-when="false">\n          <body>\n            <tr>\n              <td>\n                <button class="btn btn-default btn-xs btn-block" translate="" ng-click="onAccept()" translate-context="Accept cookies">Accept</button>\n              </td>\n              <td class="btn-separator"></td>\n              <td>\n                <button class="btn btn-default btn-xs btn-block" ng-click="onCancel()"><span class="fa fa-times"></span><span translate="" translate-context="Deny cookies">Deny</span></button>\n              </td>\n            </tr>\n            <tr>\n              <td colspan="3">\n                <button class="btn btn-success btn-xs btn-block" ng-click="onAcceptAll()"><span class="fa fa-check"></span><span translate="" translate-context="Accept all cookies">Accept all</span>\n                  <body ng-switch-when="false"></body>\n                </button>\n              </td>\n            </tr>\n          </body>\n        </table>\n        <table ng-switch-when="true">\n          <body>\n            <tr>\n              <td>\n                <button class="btn btn-success btn-xs btn-block" ng-click="onAccept()"><span class="fa fa-check"></span><span translate="" translate-context="Accept cookies">Accept</span></button>\n              </td>\n            </tr>\n            <tr>\n              <td>\n                <button class="btn btn-default btn-xs btn-block" ng-click="onCancel()"><span class="fa fa-times"></span><span translate="" translate-context="Deny cookies">Deny</span></button>\n              </td>\n            </tr>\n          </body>\n        </table>\n      </td>\n    </tr>\n    <tr class="gdpr-request-permission-area-content-btns visible-xs visible-sm">\n      <td class="text-center" colspan="2">\n        <div class="btn-group">\n          <button class="btn btn-default btn-xs" ng-click="onAccept()" ng-class="{\'btn-success\': storageSettings.defaultAllowAll}"><span class="fa fa-check" ng-show="storageSettings.defaultAllowAll"></span><span translate="" translate-context="Accept cookies">Accept</span></button>\n          <button class="btn btn-success btn-xs" ng-click="onAcceptAll()" ng-hide="storageSettings.defaultAllowAll"><span class="fa fa-check"></span><span translate="" translate-context="Accept all cookies">Accept all</span></button>\n          <button class="btn btn-default btn-xs" ng-click="onCancel()"><span class="fa fa-times"></span><span translate="" translate-context="Deny cookies">Deny</span></button>\n        </div>\n      </td>\n    </tr>\n  </tbody>\n</table>'}}),a.module("storage.gdpr").config(["storageSettingsProvider",function(a){var b,c,d;b=[{key:"_ga",provider:"google.com",purpose:"Used to distinguish users",expiry:"2 years",type:"HTTP cookie"},{key:"_gid",provider:"google.com",purpose:"24 hours",expiry:"Used to distinguish users",type:"HTTP cookie"},{key:"_gat",provider:"google.com",purpose:"Used to throttle request rate. If Google Analytics is deployed via Google Tag Manager, this cookie will be named _dc_gtm_<property-id>",expiry:"1 minute",type:"HTTP cookie"},{key:"AMP_TOKEN",provider:"google.com",purpose:"Contains a token that can be used to retrieve a Client ID from AMP Client ID service. Other possible values indicate opt-out, inflight request or an error retrieving a Client ID from AMP Client ID service",expiry:"30 seconds to 1 year",type:"HTTP cookie"},{key:"_gac_<property-id>",provider:"google.com",purpose:"Contains campaign related information for the user",expiry:"90 days",type:"HTTP cookie"},{key:"__utma",provider:"google.com",purpose:"Used to distinguish users and sessions. The cookie is created when the javascript library executes and no existing __utma cookies exists. The cookie is updated every time data is sent to Google Analytics",expiry:"2 years from set/update",type:"HTTP cookie"},{key:"__utmt",provider:"google.com",purpose:"Used to throttle request rate",expiry:"10 minutes",type:"HTTP cookie"},{key:"__utmb",provider:"google.com",purpose:"Used to determine new sessions/visits. The cookie is created when the javascript library executes and no existing __utmb cookies exists. The cookie is updated every time data is sent to Google Analytics",expiry:"30 mins from set/update",type:"HTTP cookie"},{key:"__utmz",provider:"google.com",purpose:"Stores the traffic source or campaign that explains how the user reached your site. The cookie is created when the javascript library executes and is updated every time data is sent to Google Analytics",expiry:"6 months from set/update",type:"HTTP cookie"},{key:"__utmv",provider:"google.com",purpose:"Used to store visitor-level custom variable data",expiry:"2 years from set/update",type:"HTTP cookie"},{key:"__utmx",provider:"google.com",purpose:"Used to determine a user's inclusion in an experiment",expiry:"18 months",type:"HTTP cookie"},{key:"__utmxx",provider:"google.com",purpose:"Used to determine the expiry of experiments a user has been included in",expiry:"18 months",type:"HTTP cookie"},{key:"_gaexp",provider:"google.com",purpose:"Used to determine a user's inclusion in an experiment and the expiry of experiments a user has been included in",expiry:"Depends on the length of the experiment but typically 90 days",type:"HTTP cookie"}],c=[{key:"jv_enter_ts_${jivo_visitor_id}",provider:"jivochat.com",purpose:"First visit to the website",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_visits_count_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Number of visits to the website",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_pages_count_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Number of pages viewed",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_refer_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Source of entry to the website",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_utm_${jivo_visitor_id}",provider:"jivochat.com",purpose:"ID of the marketing campaign of the visit",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_invitation_time_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Time of appearance of proactive invitation",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_country_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Country of the visitor",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_city_${jivo_visitor_id}",provider:"jivochat.com",purpose:"City of the visitor",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_close_time_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Time the widget was closed",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_cw_timer_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Time the callback request was initiated",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_callback_ping_response_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Cash of callback backend script response",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_use_lp_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Flag that enables long_pooling",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_mframe_protected_${jivo_visitor_id}",provider:"jivochat.com",purpose:"Indication if iframe is forbidden",expiry:"12 hours from set/update",type:"HTTP cookie"},{key:"jv_ab_test_group_${jivo_visitor_id}",provider:"jivochat.com",purpose:"a/b testing group flag",expiry:"12 hours from set/update",type:"HTTP cookie"}],d=[{key:"_ym_isad",provider:"yandex.com",purpose:"Used to determine if a visitor has ad blockers",expiry:"2 days",type:"HTTP cookie"},{key:"_ym_uid",provider:"yandex.com",purpose:"Used for identifying site users",expiry:"1 year",type:"HTTP cookie"},{key:"_ym_d",provider:"yandex.com",purpose:"Date of the user's first site session",expiry:"1 year",type:"HTTP cookie"},{key:"yabs-sid",provider:"yandex.com",purpose:"Session ID",expiry:"Until the session ends",type:"HTTP cookie"},{key:"_ym_debug",provider:"yandex.com",purpose:"Indicates that debug mode is active",expiry:"Until the session ends",type:"HTTP cookie"},{key:"_ym_mp2_substs",provider:"yandex.com",purpose:"Used for Target Call",expiry:"Until the session ends",type:"HTTP cookie"},{key:"i",provider:"yandex.com",purpose:"Used for identifying site users",expiry:"1 year",type:"HTTP cookie"},{key:"yandexuid",provider:"yandex.com",purpose:"Used for identifying site users",expiry:"1 year",type:"HTTP cookie"},{key:"usst",provider:"yandex.com",purpose:"Stores auxiliary information for syncing site user IDs between different Yandex domains",expiry:"1 year",type:"HTTP cookie"},{key:"_ym_visorc_*",provider:"yandex.com",purpose:"Allows Session Replay to function correctly",expiry:"30 minutes",type:"HTTP cookie"},{key:"_ym_hostIndex",provider:"yandex.com",purpose:"Limits the number of requests",expiry:"1 day",type:"HTTP cookie"},{key:"_ym_mp2_track",provider:"yandex.com",purpose:"Used for Target Call",expiry:"30 days",type:"HTTP cookie"},{key:"zz",provider:"yandex.com",purpose:"Used for identifying site users",expiry:"90 days",type:"HTTP cookie"}],a.registerThirdPartyServiceLiteral("googleAnalytics",{type:"googleAnalytics",name:"Google Analytics",cookies:b}),a.registerThirdPartyServiceLiteral("googleTagManager",{type:"googleTagManager",name:"Google Tag Manager",cookies:b}),a.registerThirdPartyServiceLiteral("jivosite",{type:"jivosite",name:"Jivochat",cookies:c}),a.registerThirdPartyServiceLiteral("yandexMetrica",{type:"yandexMetrica",name:"Yandex Metrica",cookies:d})}])});